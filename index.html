<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermomètre Interactif avec Graphique des Données Hebdomadaires</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* Light Blue Background */
            color: #2c3e50; /* Dark Blue Text */
        }

        h1 {
            font-size: 2.2em;
            margin-top: 20px;
            color: #3498db; /* Blue Header */
            text-align: center; /* Center the title */
        }

        /* Content Container */
        .content-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            gap: 30px; /* Space between elements */
            min-height: 100vh; /* Ensure the container takes up full viewport height */
        }

        /* Response Count Styles */
        .response-count {
            font-size: 1.5em; /* Fixed font size for consistency */
            color: #16a085; /* Green Color */
        }

        /* Thermometer Styles */
        .thermometer-container {
            position: relative;
            width: 80px; /* Fixed width for thermometer */
            height: 500px; /* Fixed height for thermometer */
            background: linear-gradient(to bottom, #ecf0f1, #bdc3c7); /* Light Gray */
            border-radius: 30px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .thermometer-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #e74c3c, #f39c12); /* Red to Yellow */
            border-radius: inherit; /* Match container's border-radius */
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            transition: height 0.5s ease-in-out;
        }

        .thermometer-label {
            font-size: 1.5em; /* Fixed font size for thermometer label */
            margin-top: 10px;
        }

        /* Graph Container */
        .graph-container {
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            width: 90%; /* Use most of the available width */
            height: 700px; /* Larger height for the graph container */
            position: relative; /* Add position relative */
        }

        iframe {
            width: 100%; /* Full width of the graph container */
            height: 100%; /* Full height of the graph container */
            border-radius: 10px; /* Rounded corners for iframe */
            border: none; /* Remove border for a clean look */
        }

        /* Flag Styles */
        .flag-image {
            position: absolute; /* Position absolutely within the graph container */
            top: 10px; /* Adjust as needed */
            right: 10px; /* Adjust as needed */
            width: 500px; /* Adjust size as needed */
            height: auto;
        }

        footer {
            margin-top: auto; /* Push footer to the bottom if content is small */
            padding-bottom: 20px;
            font-size: 1em; /* Fixed font size for footer text */
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Thermomètre Interactif avec Graphique des Données Hebdomadaires</h1>

    <!-- Content Container -->
    <div class="content-container">
        <!-- Thermometer -->
        <div class="thermometer-container">
            <div class="thermometer-fill" id="thermometerFill" style="height: 0%;"></div>
        </div>
        <div class="thermometer-label" id="thermometerLabel">0%</div>

        <!-- Total Responses Count -->
        <div class="response-count" id="responseCount">Réponses totales : --</div>

        <!-- Google Sheets Graph -->
        <div class="graph-container">
           <!-- Embedded Google Sheets chart -->
           <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtZ_71m1Meyy9THPbcnVJ9AVYZm9T6R0FRtDA92hKHv_klruPO-1lJb9TXSWxITQo5oS0ZD2YYzFf2/pubchart?oid=1597539294&amp;format=interactive"></iframe>
           <img src="franco.png" alt="Franco-Ontarian Flag" class="flag-image"> <!-- Flag image -->
        </div>
    </div>

    <footer>&copy; Thermomètre Interactif - Tous droits réservés</footer>

    <script>
        // Fetch thermometer data from Firebase and update the thermometer
        async function fetchDataAndUpdateThermometer() {
            try {
                const response = await fetch('https://refrancisation-default-rtdb.firebaseio.com/niveau.json'); // Firebase Realtime Database URL
                const niveau = await response.json(); // Parse JSON response

                updateThermometer(niveau);
                updateResponseCount(niveau);

                console.log("Fetched data:", niveau); // Debugging log
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('thermometerLabel').textContent = "Erreur de chargement des données !";
                document.getElementById('thermometerFill').style.height = "0%";
                document.getElementById('responseCount').textContent = "Réponses totales : Erreur";
            }
        }

        function updateThermometer(niveau) {
            const moyenne = typeof niveau.moyenne === "object"
                ? Number(niveau.moyenne.value)
                : Number(niveau.moyenne);

            const thermometerFill = document.getElementById('thermometerFill');
            const thermometerLabel = document.getElementById('thermometerLabel');

            if (!isNaN(moyenne)) {
                const percentage = Math.min((moyenne / 100) * 100, 100);
                thermometerFill.style.height = percentage + "%";
                thermometerLabel.textContent = moyenne.toFixed(1) + "%";

                console.log("Updated thermometer to:", percentage + "%");
            } else {
                console.error("Invalid moyenne value:", niveau.moyenne);
                thermometerFill.style.height = "0%";
                document.getElementById('thermometerLabel').textContent = "Données invalides";
            }
        }

        function updateResponseCount(niveau) {
            const totalResponses = typeof niveau.totalResponses === "object"
                ? Number(niveau.totalResponses.value)
                : Number(niveau.totalResponses);

            const responseCountElement = document.getElementById('responseCount');

            if (!isNaN(totalResponses)) {
                responseCountElement.textContent = `Réponses totales : ${totalResponses}`;
                console.log("Updated total responses to:", totalResponses);
            } else {
                console.error("Invalid totalResponses value:", niveau.totalResponses);
                responseCountElement.textContent = "Réponses totales : Données invalides";
            }
        }

        // Fetch thermometer data every ~1.5 seconds
        setInterval(fetchDataAndUpdateThermometer, 1500);

        // Initial fetch
        fetchDataAndUpdateThermometer();
    </script>
</body>
</html>
